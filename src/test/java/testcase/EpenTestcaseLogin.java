package testcase;

import java.net.MalformedURLException;
import java.net.URL;
import java.io.File;

import org.openqa.selenium.winium.DesktopOptions;
import org.openqa.selenium.winium.WiniumDriver;
import org.sikuli.script.FindFailed;
import org.sikuli.script.Pattern;
import org.sikuli.script.Screen;
import org.testng.annotations.Test;

public class EpenTestcaseLogin {
    @Test()
    public static void Login() throws MalformedURLException, InterruptedException, FindFailed {
        DesktopOptions option = new DesktopOptions();
        option.setApplicationPath("C:\\Users\\user\\OneDrive\\Documents\\epenV15\\epenApplication\\ePen\\ePen.exe");
        WiniumDriver driver = new WiniumDriver(new URL("http://localhost:9999"), option);
        Thread.sleep(3000);
        Screen screen = new Screen();

        // Verify image paths
        String evaluatorImage = "C:\\Users\\user\\OneDrive\\Documents\\epenV15\\SikuliImages\\evaluator1.PNG";
        String passwordImage = "C:\\Users\\user\\OneDrive\\Documents\\epenV15\\SikuliImages\\pass.JPG";

        if (!new File(evaluatorImage).exists() || !new File(passwordImage).exists()) {
            System.out.println("Image files not found. Verify the paths and filenames.");
            return;
        }

        // Load the images
        Pattern evaluatorPattern = new Pattern(evaluatorImage).similar(0.7f);
        Pattern passwordPattern = new Pattern(passwordImage).similar(0.7f);

        // Wait for the evaluator field
        screen.wait(evaluatorPattern, 20);
        System.out.println("Evaluator field found.");

        // Enter the evaluator text
        screen.type(evaluatorPattern, "I231004");

        // Move the cursor down by 1 cm
        int offsetX = 0;
        int offsetY = 50; // Adjust the offset as per your requirement
        screen.mouseMove(evaluatorPattern.targetOffset(offsetX, offsetY));

        // Click on the password field
        screen.click();

        // Enter the password
        screen.type("Raghu@123");

        // Click on the Login button
        Pattern loginPattern = new Pattern("C:\\Users\\user\\OneDrive\\Documents\\epenV15\\SikuliImages\\Login.PNG");
        screen.wait(loginPattern, 20);
        System.out.println("Login button found.");
        screen.click(loginPattern);
        Thread.sleep(3000);
        
        int offsetX1 = 100;
        int offsetY1 = 0; // Adjust the offset as per your requirement
        screen.mouseMove(evaluatorPattern.targetOffset(offsetX1, offsetY1));
        
        // Handle the OK popup
        Thread.sleep(2000);
        Pattern okPattern = new Pattern("C:\\Users\\user\\OneDrive\\Documents\\epenV15\\SikuliImages\\ok.PNG");
        
        if (screen.exists(okPattern) != null) {
            System.out.println("OK popup found.");
            screen.click(okPattern);
        }

        // Double click on the popup
        Pattern bookletPattern = new Pattern("C:\\Users\\user\\OneDrive\\Documents\\epenV15\\SikuliImages\\bookletdoubleclick.PNG");
        screen.wait(bookletPattern, 20);
        System.out.println("Booklet popup found.");
        screen.doubleClick(bookletPattern);

       
    }
}
